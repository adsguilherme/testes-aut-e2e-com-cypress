# Testando o _Logout_ usando o _Cypress Studio_

A √∫ltima funcionalidade que falta ser coberta por testes √© o _Logout_. üö™

E para (uma parte) do teste de _Logout_, vou te apresentar o _Cypress Studio_.

## Exerc√≠cio

1. No arquivo `cypress.json`, adicione a configura√ß√£o `"experimentalStudio": true`
2. No arquivo `cypress/integration/authenticatedScenarios.spec.js`, adicione o seguinte teste:

```js
// cypress/integration/authenticatedScenarios.spec.js

describe('Scenarios where authentication is a pre-requirement', () => {
  // C√≥digo j√° existente ...

  it.only('logs out', () => {
    cy.visit('/')
    cy.wait('@getNotes')
  })
})
```

3. Caso o Cypress _Runner_ esteja aberto, feche-o e abra-o novamente
4. Clique no arquivo `authenticatedScenarios.spec.js` para executar s√≥ o novo teste, visto que adicionamos um `.only` ao mesmo
5. Ap√≥s a execu√ß√£o do teste, no Cypress _Runner_, passe o cursor pelo teste `logs out` e ent√£o clique no √≠cone da varinha m√°gica ü™Ñ (_Add Commands to Test_)

> **Obs.:** Na primeira vez que voc√™ usa o _Cypress Studio_, um modal √© exibido com o bot√£o <kbd>Get Started</kbd>. Clique nele para continuar.

6. O teste ser√° executado e vai parar logo ap√≥s o comando `cy.wait('@getNotes')`, para que seja continuado a partir do _Cypress Studio_. No modo de adi√ß√£o de comandos, clique no link de _Logout_ da aplica√ß√£o, e assim que o usu√°rio for direcionado para a p√°gina de _login_, clique com o bot√£o direito no campo de email e adicione uma verifica√ß√£o de que o mesmo est√° vis√≠vel (**_be visible_**), "provando" que o _Logout_ funcinou
7. Com a verifica√ß√£o adicionada, clique no bot√£o <kbd>Save Commands</kbd>
8. O teste deve ser re-executado, agora com os passos previamente codificados como tamb√©m com os passos rec√©m adicionados via _Cypress Studio_
9. Volte para o arquivo `authenticatedScenarios.spec.js` e verifique o c√≥digo adiconado "auto-magicamente". üé©üêá

O novo teste deve estar como o c√≥digo abaixo:

```js
// cypress/integration/authenticatedScenarios.spec.js

// Outros testes aqui ...

it.only('logs out', () => {
  cy.visit('/')
  cy.wait('@getNotes')
  /* ==== Generated with Cypress Studio ==== */
  cy.get('.nav > :nth-child(2) > a').click();
  cy.get('#email').should('be.visible');
  /* ==== End Cypress Studio ==== */
})
```

> **Obs. 2:** Perceba o c√≥digo adicionado via _Cypress Studio_ entre os coment√°rios _`Generated with Cypress Studio`_ e _`End Cypress Studio`_.

10. Visto que o Cypress _Studio_ adiciona ponto-e-v√≠rgula depois de cada comando, no terminal de linha de comando, na raiz do projeto, execute o comando `npm run lint:fix`
>
> **Obs. 3:** N√£o esque√ßa de remover o `.only` do novo teste assim que o mesmo estiver passando. üòâ
>
> **Obs. 4:** Vale lembrar que, na data de grava√ß√£o deste curso, o _Cypress Studio_ ainda √© funcionalidade experimental. Isso significa que ainda podem haver bugs e seu funcionamento pode sofrer mudan√ßas no futuro. Portanto, deixo aqui a refer√™ncia para a [documenta√ß√£o oficial](https://docs.cypress.io/guides/core-concepts/cypress-studio).

## Exerc√≠cio extra -  Testando no _viewport_ de um dispositivo m√≥vel üì±

A aplica√ß√£o **Scratch** renderiza com uma pequena diferen√ßa quando em um _viewport_ com largura menor que 768. Em tal situa√ß√£o, o menu com os links de _Settings_ e _Logout_ √© escondido e para acessar tais links √© necess√°rio clicar em um bot√£o que exibe e esconde os links.

Teu exerc√≠cio √©:

1. Adicione a seguinte propriedade no arquivo `cypress.json`:

```json
"env": {
  "viewportWidthBreakpoint": 768
},
```

2. No teste de _Logout_, entre o comando `cy.wait('@getNotes')` e os comandos adicionados via _Cypress Studio_, adicione o seguinte c√≥digo:

```js
if (Cypress.config('viewportWidth') < Cypress.env('viewportWidthBreakpoint')) {
  cy.get('.navbar-toggle.collapsed')
    .should('be.visible')
    .click()
}
```

3. Caso o Cypress _Runner_ esteja aberto, feche-o e abra-o novamente, por√©m, com o comando `npx cypress open --config viewportWidth=767,viewportHeight=480`
4. Execute o teste e garanta que o mesmo est√° passando antes de seguir adiante.

___

Legal! Agora, al√©m de cobrir o cen√°rio de _Logout_ com um teste automatizado, estamos verificando o mesmo sob a perspectiva de dois _viewports_ diferentes.

V√° para a [aula 7](./7.md) e vamos configurar os testes e an√°lise est√°tica de c√≥digo para rodar no processo de integra√ß√£o cont√≠nua.
